@model IEnumerable<BlindRiver.Models.contact_location>

@{
    ViewBag.Title = "Locations on Google Map";
}
@*using Google API to shpw google map*@
<script type="text/javascript" src="http://www.google.com/jsapi?autoload={'modules':[{name:'maps',version:3,other_params:''}]}"></script>
<script type="text/javascript">

    function init() {
        var mapDiv = document.getElementById('map-canvas');

        var mapOptions = {
            center: new google.maps.LatLng(46.18736, -82.92406),
            zoom: 8,
            mapTypeControl: true,
            zoomControl: true,
            scaleControl: true,
            streetViewControl: true,
            mapTypeId: google.maps.MapTypeId.ROADMAP
        }

        var map = new google.maps.Map(mapDiv, mapOptions);

        setMarkers(map);
    }

    function setMarkers(map) {

        @foreach (var item in Model)
        {
            <text>
        var myLatLng = new google.maps.LatLng(@item.latitude, @item.longitude);
        var marker = new google.maps.Marker({
            position: myLatLng,
            map: map,
            title: '@item.title',
            zIndex: 10
        });
            </text>
        }

        //show popup in location marker click
        //declare addMarker function
        function addMarker(latitude, longitude, title, description, map)
        {
            var latLng = new google.maps.LatLng(latitude, longitude);
            var contentString = '<h3>' + title + '</h3>' + '<p>' + description + '</p>';

            var infowindow = new google.maps.InfoWindow({
                content: contentString
            });

            var marker = new google.maps.Marker({
                position: latLng,
                title: title,
                map: map,
                draggable: false
            });

            google.maps.event.addListener(marker, 'click', function () {
                infowindow.open(map, marker);
            });
        }

        //adding markers
        @foreach (var item in Model) {
        @:addMarker(@item.latitude, @item.longitude, '@item.title', '@item.address', map);
         }
    }
    google.maps.event.addDomListener(window, 'load', init);
</script>

<style>
    #map_canvas img {
        max-width: none;
    }

    .infoDiv {
        height: 200px;
        width: 300px;
        -webkit-user-select: none;
        background-color: white;
    }
</style>

<div id="map-canvas"></div>